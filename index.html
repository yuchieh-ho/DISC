<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性格測驗 (OGDI)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        /* --- 個人資料區塊 --- */
        .info-section {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #bbdefb;
        }
        .info-group {
            margin-bottom: 15px;
        }
        .info-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #0d47a1;
        }
        .info-group select, .info-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* --- 題目區塊 --- */
        .question-block {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            transition: background 0.2s;
        }
        .option-label:hover {
            background-color: #f9f9f9;
        }
        .option-label input {
            margin-right: 10px;
        }
        .score-desc {
            font-size: 0.85em;
            color: #666;
            margin-left: auto;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }
        .text-a { color: #d9534f; font-weight: bold; }
        .text-b { color: #0275d8; font-weight: bold; }

        button.submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        button.submit-btn:hover {
            background-color: #218838;
        }

        /* --- 結果區塊 --- */
        #result-area {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 5px;
            display: none;
        }
        
        /* 新增：最終判定類型的大標題樣式 */
        .final-type-box {
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #28a745;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .final-type-title {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 10px;
        }
        .final-type-result {
            font-size: 2.5em;
            font-weight: bold;
            color: #28a745;
        }
        
        .user-result-summary {
            background: #fff;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 5px solid #007bff;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            font-size: 1.2em;
            margin: 8px 0;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
        }
        /* 高亮顯示最高分的項目 */
        .highlight-score {
            color: #d9534f;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>辨識你的 DISC 人格類型（出處白金定律）</h1>
    
    <div class="info-section">
        <div class="info-group">
            <label for="user-role">身份選擇</label>
            <select id="user-role">
                <option value="" disabled selected>-- 請選擇身份 --</option>
                <option value="老師">老師</option>
                <option value="學生">學生</option>
            </select>
        </div>

        <div class="info-group">
            <label for="user-id">員工編號</label>
            <input type="text" id="user-id" placeholder="請輸入您的員工編號">
        </div>

        <div class="info-group">
            <label for="user-unit">所屬單位</label>
            <select id="user-unit">
                <option value="" disabled selected>-- 請選擇單位 --</option>
                <option value="ND">ND</option>
                <option value="15A">15A</option>
                <option value="15B">15B</option>
                <option value="13B">13B</option>
                <option value="12A">12A</option>
                <option value="12B">12B</option>
                <option value="11A">11A</option>
                <option value="10B">10B</option>
                <option value="9A">9A</option>
                <option value="9B">9B</option>
                <option value="8A">8A</option>
                <option value="8B">8B</option>
                <option value="6C">6C</option>
                <option value="5A">5A</option>
                <option value="5B">5B</option>
                <option value="3D">3D</option>
                <option value="RCC">RCC</option>
                <option value="MICU">MICU</option>
                <option value="CCU">CCU</option>
                <option value="SICU">SICU</option>
                <option value="PICU">PICU</option>
                <option value="OPD">OPD</option>
                <option value="ER">ER</option>
            </select>
        </div>
    </div>

    <p style="text-align: center; color: #666; margin-bottom: 20px;">請依照您的直覺，選擇每一題最符合您的狀況。</p>
    
    <form id="quizForm">
        <div id="questions-container"></div>
        <button type="button" id="submitBtn" class="submit-btn" onclick="calculateResult()">查看結果並送出</button>
    </form>

    <div id="result-area">
        <div class="final-type-box">
            <div class="final-type-title">您的性格類型分析結果</div>
            <div id="final-type-text" class="final-type-result">計算中...</div>
        </div>

        <div class="user-result-summary">
            <strong>身份：</strong><span id="res-role"></span><br>
            <strong>編號：</strong><span id="res-id"></span><br>
            <strong>單位：</strong><span id="res-unit"></span>
        </div>

        <div class="result-row"><span>O :</span> <span id="score-O">0</span></div>
        <div class="result-row"><span>G :</span> <span id="score-G">0</span></div>
        <div class="result-row"><span>D :</span> <span id="score-D">0</span></div>
        <div class="result-row"><span>I :</span> <span id="score-I">0</span></div>
        <p style="margin-top:20px; font-size: 0.9em; color: #555;">* 總分應為 54 分</p>
    </div>
</div>

<script>
    // --- 1. 題目資料 ---
    const questions = [
        { A: "我是真心想了解別人，並建立友誼。", B: "我通常不會開放心胸去了解別人，並與他們建立友誼。" }, 
        { A: "我反應較慢而且會深思熟慮。", B: "我反應迅速而且是自動自發的。" },
        { A: "對於別人佔用我的時間，我保持審慎的態度。", B: "對於別人佔用我的時間，我總是盡量配合。" },
        { A: "在社交場合中，我總會主動自我介紹。", B: "在社交場合中，我總是等著別人走過來，像我介紹他們自己。" },
        { A: "與他人交談時，我通常把談話的焦點放在對方身上，雖然有時與原來的主題不甚相關，我也不以為意。", B: "與他人交談時，我通常把談話的主題，放在工作、議題或其他事物上" },
        { A: "我通常有點猶豫不決，而且對緩慢的節奏有耐心。", B: "我通常十分果決，而且對緩慢的節奏沒什麼耐性。" },
        { A: "我通常依事實或證據來決定事情。", B: "我通常靠感覺或經驗來決定事情。" },
        { A: "我喜歡參與團體討論。", B: "我不喜歡參與團體討論" },
        { A: "我通常願意和別人共識，並在可能時提供協助。", B: "我通常喜歡獨立完成一項工作，即使是團隊的工作，我也希望自己完成自己的部分。" },
        { A: "我通常會問問題，或是試探性、委婉地發表意見。", B: "我通常會做出直接了當地陳述，或直接表達出我的意見。" },
        { A: "我主要著重在生意、觀念及成果上。", B: "我主要著重在人、互動及感覺上。" },
        { A: "我使用手勢、臉部表情或抑揚頓挫，來強調我說話的重點。", B: "我不使用手勢、臉部表情或抑揚頓挫，來強調我說話的重點。" },
        { A: "我通常會接受別人的觀點（包括主意、感覺及顧慮）。", B: "我通常不會接受別人的觀點（包括主意、感覺及顧慮）。" },
        { A: "我通常只在審慎評估後及可預測的情況下，才會冒險及做出改變。", B: "我通常會在充滿活力及未知的狀況下，勇於冒險並做出改變。" },
        { A: "我通常會保有個人的感覺及看法，只有在我願意時，才會與人分享。", B: "我常將與別人分享及討論我的感覺，視為輕鬆自在的事。" },
        { A: "我通常常會尋求嶄新或不同的經驗及狀況。", B: "我通常會選擇已知或熟稔的狀況。" },
        { A: "對別人提出的議題、興趣及關心的事物，我通常會有所反應。", B: "我只對自己的議題、興趣及關心的事物有興趣。" },
        { A: "我對別人和我之間人際關係的衝突反應，是緩慢而且不直接的。", B: "我對別人和我之間人際關係的衝突反應，是迅速而且直接的。" }
    ];

    // --- 2. 初始化題目 ---
    const container = document.getElementById('questions-container');

    questions.forEach((q, index) => {
        const n = index + 1;
        const html = `
            <div class="question-block">
                <div class="question-title">第 ${n} 題</div>
                <div class="options-container">
                    <label class="option-label">
                        <input type="radio" name="q${n}" value="3">
                        <div>
                            <span class="text-a">完全符合 A</span>：${q.A} <br>
                            <span style="color:#ccc; font-size:0.8em;">(完全不符合 B)</span>
                        </div>
                        <span class="score-desc">A:3 / B:0</span>
                    </label>

                    <label class="option-label">
                        <input type="radio" name="q${n}" value="2">
                        <div>
                            <span class="text-a">比較符合 A</span>：${q.A}
                        </div>
                        <span class="score-desc">A:2 / B:1</span>
                    </label>

                    <label class="option-label">
                        <input type="radio" name="q${n}" value="1">
                        <div>
                            <span class="text-b">比較符合 B</span>：${q.B}
                        </div>
                        <span class="score-desc">A:1 / B:2</span>
                    </label>

                    <label class="option-label">
                        <input type="radio" name="q${n}" value="0">
                        <div>
                            <span class="text-b">完全符合 B</span>：${q.B} <br>
                            <span style="color:#ccc; font-size:0.8em;">(完全不符合 A)</span>
                        </div>
                        <span class="score-desc">A:0 / B:3</span>
                    </label>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    });

    // --- 3. 計算邏輯 ---
    function calculateResult() {
        const userRole = document.getElementById('user-role').value;
        const userId = document.getElementById('user-id').value.trim();
        const userUnit = document.getElementById('user-unit').value;

        if (!userRole) { alert("請選擇「身份」"); document.getElementById('user-role').focus(); return; }
        if (!userId) { alert("請輸入「員工編號」"); document.getElementById('user-id').focus(); return; }
        if (!userUnit) { alert("請選擇「所屬單位」"); document.getElementById('user-unit').focus(); return; }

        let O = 0, G = 0, D = 0, I = 0;
        let allAnswered = true;

        for (let n = 1; n <= 18; n++) {
            const radios = document.getElementsByName(`q${n}`);
            let valA = -1;
            for (const radio of radios) {
                if (radio.checked) {
                    valA = parseInt(radio.value);
                    break;
                }
            }
            if (valA === -1) { allAnswered = false; break; }

            let valB = 3 - valA;

            if ((n + 3) % 4 === 0) { O += valA; G += valB; } 
            else if ((n + 1) % 4 === 0) { O += valB; G += valA; } 
            else if (n % 4 === 0) { D += valA; I += valB; } 
            else if ((n + 2) % 4 === 0) { D += valB; I += valA; }
        }

        if (!allAnswered) {
            alert("您還有題目未完成，請完成所有 18 題後再查看結果！");
            return;
        }

        // --- 結果顯示設定 ---
        document.getElementById('res-role').innerText = userRole;
        document.getElementById('res-id').innerText = userId;
        document.getElementById('res-unit').innerText = userUnit;

        // 填入分數
        document.getElementById('score-O').innerText = O;
        document.getElementById('score-G').innerText = G;
        document.getElementById('score-D').innerText = D;
        document.getElementById('score-I').innerText = I;

        // --- 新增：分類判定邏輯 ---
        // 1. 將分數放入陣列並排序
        let scores = [
            { type: 'O', val: O },
            { type: 'G', val: G },
            { type: 'D', val: D },
            { type: 'I', val: I }
        ];

        // 依照分數由大到小排序 (如果分數相同，保持原本順序)
        scores.sort((a, b) => b.val - a.val);

        // 取出前兩名
        let top1 = scores[0].type;
        let top2 = scores[1].type;
        
        // 用一個簡單的檢查函數來確認是否包含某個字母
        const has = (type) => (top1 === type || top2 === type);

        let finalType = "";
        
        // 依照您的規則進行匹配
        // 規則：G,D最高 -> D類型 | O,D最高 -> I類型 | O,I最高 -> S類型 | G,I最高 -> C類型
        
        if (has('G') && has('D')) {
            finalType = "老虎 D 支配型";
        } else if (has('O') && has('D')) {
            finalType = "孔雀 I 影響型";
        } else if (has('O') && has('I')) {
            finalType = "無尾熊 S 穩健型";
        } else if (has('G') && has('I')) {
            finalType = "貓頭鷹 C 分析型";
        } else {
            // 處理未定義的組合 (O+G 或 D+I)
            finalType = `複合類型 (${top1}+${top2})`; 
        }

        document.getElementById('final-type-text').innerText = finalType;

        // 顯示結果區
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
	
	// === 傳送資料到 Google Sheets ===
        const btn = document.getElementById('submitBtn');
        btn.innerText = "資料傳送中...";
        btn.disabled = true;

        // 【重要】請把下面這行引號內的網址，換成你部署好的 Google Apps Script 網址
        const googleScriptUrl = "https://script.google.com/macros/s/AKfycbyLVoR7xrOTq_ccbXyT3Pl_JYRJqQGKOdHVIdE9GrXSaGl9UN_gNHwESY8lW4Vf1_IYGA/exec"; 

        const dataToSend = {
            role: userRole,
            id: userId,
            unit: userUnit,
            O: O, G: G, D: D, I: I,
            finalType: finalType
        };

        fetch(googleScriptUrl, {
            method: 'POST',
            mode: 'no-cors', // 這是關鍵，讓瀏覽器允許跨域傳送
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSend)
        }).then(() => {
            btn.innerText = "結果已送出";
            alert("測驗完成！結果已記錄。");
        }).catch(err => {
            console.error(err);
            btn.innerText = "傳送失敗";
            alert("結果顯示成功，但傳送至後台失敗，請截圖保存。");
        });
    }
    
</script>

</body>
</html>